# FlowGenX Backend

## Project Description

The FlowGenX Backend is a FastAPI-based application designed to power conversational AI experiences. It handles chat interactions, integrates with Large Language Models (LLMs), manages workflows, and persists conversation data into a PostgreSQL database.

## Features

- **Conversational AI:** Manages chat messages and AI responses.
- **LLM Integration:** Interfaces with Large Language Models for generating AI responses.
- **Workflow Management:** Supports various AI-driven workflows.
- **Database Persistence:** Saves user messages and AI responses to a PostgreSQL database.
- **CORS Enabled:** Configured to handle cross-origin requests.

## Technologies Used

- **FastAPI:** High-performance web framework for building APIs.
- **Python 3.9+:** The programming language.
- **PostgreSQL:** Relational database for data storage.
- **Psycopg:** PostgreSQL adapter for Python.
- **python-dotenv:** For managing environment variables.
- **Uvicorn:** ASGI server for running the FastAPI application.

## Setup Instructions

### Prerequisites

- Python 3.9 or higher
- PostgreSQL installed and running
- `pip` (Python package installer)

### 1. Clone the Repository

```bash
git clone https://github.com/Saimon8420/flowgenx_assignment_BE.git
cd flowgenx_backend
```

### 2. Create and Activate a Virtual Environment

It's recommended to use a virtual environment to manage project dependencies.

```bash
python -m venv venv
# On Windows
.\venv\Scripts\activate
# On macOS/Linux
source venv/bin/activate
```

### 3. Install Dependencies

Install all required Python packages using pip:

```bash
pip install -r requirements.txt
```

### 4. Environment Variables Configuration

Create a `.env` file in the root directory of the project (`flowgenx_backend/`) and add your database connection string.

```
DATABASE_URL="postgresql://user:password@host:port/database_name"
```

**Example:**

```
DATABASE_URL="postgresql://postgres:mysecretpassword@localhost:5432/flowgenx_db"
```

Ensure your PostgreSQL database is running and accessible with the provided credentials.

## Running the Application

To start the FastAPI development server:

```bash
uvicorn main:app --reload
```

The `--reload` flag enables auto-reloading of the server on code changes, which is useful during development.

The application will be accessible at `http://127.0.0.1:8000`.

## API Endpoints

### Root Endpoint

- **GET `/`**
  - **Description:** Checks if the API is running.
  - **Response:** `{"message": "FlowGenx API running successfully"}`

### Database Operations

- **POST `/api/db/save`**
  - **Description:** Saves a user message and AI response to the database.
  - **Request Body Example:**
    ```json
    {
      "user_message": "What is the capital of France?",
      "ai_response": "The capital of France is Paris."
    }
    ```
  - **Response:** `{"status": "saved"}`

### Chat Endpoints

- **`/api/chat/...`**: (Details to be added based on `routers/chat.py`)

### LLM Endpoints

- **`/api/llm/...`**: (Details to be added based on `routers/llm.py`)

### Workflow Endpoints

- **`/api/workflow/...`**: (Details to be added based on `routers/workflow.py`)

## Database Schema

The backend uses a `conversations` table to store chat interactions:

### `conversations` Table

| Column         | Type        | Constraints                 | Description                                    |
| :------------- | :---------- | :-------------------------- | :--------------------------------------------- |
| `id`           | `SERIAL`    | `PRIMARY KEY`               | Unique identifier for the conversation record. |
| `user_message` | `TEXT`      | `NOT NULL`                  | The message sent by the user.                  |
| `ai_response`  | `TEXT`      | `NOT NULL`                  | The response generated by the AI.              |
| `created_at`   | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP` | Timestamp when the record was created.         |

## Troubleshooting

- **`uvicorn` not found:** Ensure your virtual environment is activated and `uvicorn` is installed (`pip install uvicorn`).
- **Database connection errors:**
  - Verify your `DATABASE_URL` in the `.env` file is correct.
  - Ensure your PostgreSQL server is running and accessible.
  - Check firewall settings if connecting to a remote database.
- **Table creation errors:** If the application fails to start with a table creation error, check your PostgreSQL logs and ensure the database user has sufficient permissions to create tables.
